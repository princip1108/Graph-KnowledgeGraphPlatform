<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout/base}">

<head>
    <title>找回密码 - Graph+知识图谱平台</title>
    <th:block layout:fragment="css">
        <link rel="stylesheet" th:href="@{/css/password-reset.css}">
    </th:block>
</head>

<body>
    <div layout:fragment="content">
        <!-- Authentication Layout -->
        <div class="flex-1 flex items-center justify-center py-8 px-4" style="background-image: url('https://spark-builder.s3.cn-north-1.amazonaws.com.cn/image/2025/10/28/cbbbeed4-b24d-4ed8-a649-f6fd1eb7f280.png'); background-size: cover; background-position: center; background-attachment: fixed;">
            <div class="absolute inset-0 bg-base-100/80 backdrop-blur-sm"></div>
            
            <div class="relative z-10 w-full max-w-5xl">
                <!-- Main Card Container -->
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body p-0">
                        <!-- Header Section -->
                        <div class="flex items-center justify-center p-6 border-b academic-border">
                            <div class="flex items-center gap-3">
                                <img src="https://spark-builder.s3.cn-north-1.amazonaws.com.cn/image/2025/10/28/f45dbf91-f7e9-48de-8c29-295cd7ed0add.png" alt="Logo" class="w-12 h-12">
                                <div>
                                    <h1 class="text-2xl font-bold text-base-content">Graph+知识图谱平台</h1>
                                    <p class="text-sm text-base-content/70">安全可靠的密码重置</p>
                                </div>
                            </div>
                        </div>

                        <!-- Main Content -->
                        <div class="flex flex-col lg:flex-row">
                            <!-- Left Side: Progress Tracker -->
                            <div class="w-full lg:w-2/5 p-8 bg-base-200/50">
                                <div class="space-y-6">
                                    <h2 class="text-lg font-semibold text-base-content mb-6">密码重置流程</h2>
                                    
                                    <div class="steps steps-vertical lg:steps-vertical">
                                        <div class="step step-primary" id="step-1">
                                            <div class="flex flex-col items-start text-left ml-4">
                                                <span class="font-medium">验证身份</span>
                                                <span class="text-sm text-base-content/70">输入邮箱或手机号获取验证码</span>
                                            </div>
                                        </div>
                                        <div class="step" id="step-2">
                                            <div class="flex flex-col items-start text-left ml-4">
                                                <span class="font-medium">设置新密码</span>
                                                <span class="text-sm text-base-content/70">创建安全的新密码</span>
                                            </div>
                                        </div>
                                        <div class="step" id="step-3">
                                            <div class="flex flex-col items-start text-left ml-4">
                                                <span class="font-medium">完成重置</span>
                                                <span class="text-sm text-base-content/70">密码重置成功</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="alert alert-info mt-8">
                                        <span class="iconify" data-icon="heroicons:shield-check" data-width="20"></span>
                                        <div class="text-sm">
                                            <div class="font-medium">安全提示</div>
                                            <div class="text-base-content/70 mt-1">
                                                • 验证码有效期为5分钟<br>
                                                • 新密码需包含字母和数字<br>
                                                • 建议使用强密码保护账户安全
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Right Side: Reset Form -->
                            <div class="w-full lg:w-3/5 p-8">
                                <div class="max-w-md mx-auto">
                                    <h2 class="text-2xl font-bold text-base-content mb-2">找回密码</h2>
                                    <p class="text-base-content/70 mb-8">请按照以下步骤重置您的密码</p>

                                    <!-- Step 1: Identity Verification -->
                                    <div id="verification-step" class="space-y-6">
                                        <div class="form-control">
                                            <label class="label">
                                                <span class="label-text font-medium">邮箱或手机号 *</span>
                                            </label>
                                            <input type="text" placeholder="请输入您的邮箱或手机号" class="input input-bordered w-full focus-primary" id="contact-input">
                                            <div class="error-container h-6 mt-1"></div>
                                        </div>

                                        <div class="form-control">
                                            <label class="label">
                                                <span class="label-text font-medium">验证码 *</span>
                                            </label>
                                            <div class="flex gap-2">
                                                <input type="text" placeholder="请输入6位验证码" class="input input-bordered flex-1 focus-primary" id="verification-code" maxlength="6">
                                                <button class="btn btn-outline btn-primary" id="send-code-btn" onclick="sendVerificationCode()">
                                                    获取验证码
                                                </button>
                                            </div>
                                            <div class="error-container h-6 mt-1"></div>
                                            <div class="label">
                                                <span class="label-text-alt text-base-content/70">
                                                    <span id="resend-timer" class="hidden">
                                                        <span id="countdown">60</span>秒后可重新发送
                                                    </span>
                                                    <a href="#" class="link link-primary" id="resend-link" onclick="sendVerificationCode()" style="display: none;">重新发送验证码</a>
                                                </span>
                                            </div>
                                        </div>

                                        <button class="btn btn-primary w-full" onclick="verifyCode()">
                                            验证
                                        </button>
                                    </div>

                                    <!-- Step 2: Set New Password -->
                                    <div id="password-step" class="space-y-6 hidden">
                                        <div class="form-control">
                                            <label class="label">
                                                <span class="label-text font-medium">新密码 *</span>
                                            </label>
                                            <div class="relative">
                                                <input type="password" placeholder="请设置8-20位包含字母和数字的密码" class="input input-bordered w-full pr-10 focus-primary" id="new-password">
                                                <span class="absolute right-3 top-3 cursor-pointer password-toggle" onclick="togglePasswordVisibility('new-password')">
                                                    <span class="iconify" data-icon="heroicons:eye" data-width="20"></span>
                                                </span>
                                            </div>
                                            <div class="error-container h-6 mt-1"></div>
                                            
                                            <div class="mt-2">
                                                <div class="text-sm text-base-content/70 mb-1">密码强度</div>
                                                <div class="flex gap-1">
                                                    <div class="h-2 flex-1 bg-base-300 rounded" id="strength-1"></div>
                                                    <div class="h-2 flex-1 bg-base-300 rounded" id="strength-2"></div>
                                                    <div class="h-2 flex-1 bg-base-300 rounded" id="strength-3"></div>
                                                    <div class="h-2 flex-1 bg-base-300 rounded" id="strength-4"></div>
                                                </div>
                                                <div class="text-xs text-base-content/70 mt-1" id="strength-text">请输入密码</div>
                                            </div>
                                        </div>

                                        <div class="form-control">
                                            <label class="label">
                                                <span class="label-text font-medium">确认新密码 *</span>
                                            </label>
                                            <div class="relative">
                                                <input type="password" placeholder="请再次输入新密码" class="input input-bordered w-full pr-10 focus-primary" id="confirm-password">
                                                <span class="absolute right-3 top-3 cursor-pointer password-toggle" onclick="togglePasswordVisibility('confirm-password')">
                                                    <span class="iconify" data-icon="heroicons:eye" data-width="20"></span>
                                                </span>
                                            </div>
                                            <div class="error-container h-6 mt-1"></div>
                                        </div>

                                        <button class="btn btn-primary w-full" onclick="resetPassword()">
                                            重置密码
                                        </button>
                                    </div>

                                    <!-- Step 3: Success -->
                                    <div id="success-step" class="text-center space-y-6 hidden">
                                        <div class="flex justify-center">
                                            <div class="w-16 h-16 bg-success/20 rounded-full flex items-center justify-center">
                                                <span class="iconify text-success" data-icon="heroicons:check-circle" data-width="32"></span>
                                            </div>
                                        </div>
                                        <div>
                                            <h3 class="text-xl font-semibold text-base-content mb-2">密码重置成功！</h3>
                                            <p class="text-base-content/70">您的密码已成功重置，请使用新密码登录</p>
                                        </div>
                                        <a th:href="@{/user/login_register.html}" class="btn btn-primary w-full">
                                            立即登录
                                        </a>
                                    </div>

                                    <!-- Back to Login Link -->
                                    <div class="text-center mt-8" id="back-link">
                                        <span class="text-base-content/70">想起密码了？</span>
                                        <a th:href="@{/user/login_register.html}" class="link link-primary font-medium ml-1">
                                            返回登录
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <th:block layout:fragment="js">
        <script th:src="@{/js/password-reset.js}"></script>
    </th:block>
</body>

</html>
