<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout/base}">

<head>
    <title>管理中心 - Graph+知识图谱平台</title>
    <th:block layout:fragment="css">
        <link rel="stylesheet" th:href="@{/css/dashboard.css}">
    </th:block>
</head>

<body>
    <div layout:fragment="content">
        <!-- Main Layout -->
        <div class="flex min-h-screen">
            <!-- Sidebar -->
            <div class="w-64 bg-base-200 border-r academic-border">
                <div class="p-6">
                    <h2 class="text-lg font-semibold text-base-content mb-6">管理中心</h2>
                    <div class="mb-8">
                        <h3 class="text-sm font-medium text-base-content/70 uppercase tracking-wide mb-3">用户管理</h3>
                        <nav class="space-y-2 sidebar-nav">
                            <a data-section="graph-batch" class="nav-item active flex items-center gap-3 px-3 py-2 rounded-lg text-base-content cursor-pointer" onclick="showSection('graph-batch')">
                                <span class="iconify text-primary" data-icon="heroicons:squares-2x2" data-width="20"></span>
                                <span>图谱批量管理</span>
                            </a>
                            <a data-section="post-batch" class="nav-item flex items-center gap-3 px-3 py-2 rounded-lg text-base-content cursor-pointer" onclick="showSection('post-batch')">
                                <span class="iconify text-primary" data-icon="heroicons:document-text" data-width="20"></span>
                                <span>帖子批量管理</span>
                            </a>
                        </nav>
                    </div>
                    <div id="admin-section" class="mb-8" style="display: none;">
                        <h3 class="text-sm font-medium text-base-content/70 uppercase tracking-wide mb-3">管理员管理</h3>
                        <nav class="space-y-2 sidebar-nav">
                            <a data-section="user-permission" class="nav-item flex items-center gap-3 px-3 py-2 rounded-lg text-base-content cursor-pointer" onclick="showSection('user-permission')">
                                <span class="iconify text-primary" data-icon="heroicons:user-group" data-width="20"></span>
                                <span>用户权限管理</span>
                            </a>
                            <a data-section="forum-management" class="nav-item flex items-center gap-3 px-3 py-2 rounded-lg text-base-content cursor-pointer" onclick="showSection('forum-management')">
                                <span class="iconify text-primary" data-icon="heroicons:chat-bubble-left-right" data-width="20"></span>
                                <span>论坛管理</span>
                            </a>
                        </nav>
                    </div>
                </div>
            </div>
            
            <!-- Content Area -->
            <div class="flex-1 p-8">
                <!-- Graph Batch Section -->
                <div id="graph-batch-section" class="content-section active">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold text-base-content mb-2">图谱批量管理</h1>
                        <p class="text-base-content/70">批量管理您的知识图谱，包括上线、下线、删除、上传和修改操作</p>
                    </div>
                    <div class="flex flex-wrap gap-3 mb-6">
                        <button class="btn btn-primary gap-2" onclick="openUploadModal()">
                            <span class="iconify" data-icon="heroicons:arrow-up-tray" data-width="20"></span>上传图谱
                        </button>
                        <button class="btn btn-secondary gap-2" onclick="handleBatchOperation('online')">
                            <span class="iconify" data-icon="heroicons:arrow-up-circle" data-width="20"></span>批量上线
                        </button>
                        <button class="btn btn-warning gap-2" onclick="handleBatchOperation('offline')">
                            <span class="iconify" data-icon="heroicons:arrow-down-circle" data-width="20"></span>批量下线
                        </button>
                        <button class="btn btn-error gap-2" onclick="handleBatchOperation('delete')">
                            <span class="iconify" data-icon="heroicons:trash" data-width="20"></span>批量删除
                        </button>
                    </div>
                    <div class="flex gap-4 mb-6">
                        <div class="join flex-1">
                            <input id="searchInput" type="text" placeholder="搜索图谱名称..." class="input input-bordered join-item flex-1" onkeypress="if(event.key==='Enter') performSearch()">
                            <button class="btn join-item btn-primary" onclick="performSearch()">
                                <span class="iconify" data-icon="heroicons:magnifying-glass" data-width="20"></span>
                            </button>
                        </div>
                        <select id="statusFilter" class="select select-bordered w-48" onchange="filterByStatus(this.value)">
                            <option value="all">全部状态</option>
                            <option value="PUBLISHED">已上线</option>
                            <option value="DRAFT">草稿</option>
                            <option value="PRIVATE">私有</option>
                        </select>
                    </div>
                    <div class="overflow-x-auto bg-base-100 rounded-lg shadow-soft border academic-border">
                        <table class="table">
                            <thead>
                                <tr class="bg-base-200">
                                    <th><input type="checkbox" class="checkbox checkbox-primary" id="selectAll" onchange="toggleSelectAll(this)"></th>
                                    <th>图谱信息</th>
                                    <th>状态</th>
                                    <th>上传日期</th>
                                    <th>最后修改</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="graphTableBody">
                                <tr><td colspan="6" class="text-center py-8 text-base-content/60"><span class="loading loading-spinner loading-md"></span><span class="ml-2">加载中...</span></td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="flex justify-between items-center mt-6">
                        <div id="paginationInfo" class="text-sm text-base-content/70">加载中...</div>
                        <div id="paginationButtons" class="join"></div>
                    </div>
                </div>
                
                <!-- Post Batch Section -->
                <div id="post-batch-section" class="content-section">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold text-base-content mb-2">帖子批量管理</h1>
                        <p class="text-base-content/70">管理您发布的帖子</p>
                    </div>
                    <div class="flex flex-wrap gap-3 mb-6">
                        <button class="btn btn-primary gap-2" onclick="goToCreatePost()">
                            <span class="iconify" data-icon="heroicons:plus" data-width="20"></span>发布帖子
                        </button>
                        <button class="btn btn-success gap-2" onclick="handlePostBatchOnline()">
                            <span class="iconify" data-icon="heroicons:eye" data-width="20"></span>批量上线
                        </button>
                        <button class="btn btn-warning gap-2" onclick="handlePostBatchOffline()">
                            <span class="iconify" data-icon="heroicons:eye-slash" data-width="20"></span>批量下线
                        </button>
                        <button class="btn btn-error gap-2" onclick="handlePostBatchDelete()">
                            <span class="iconify" data-icon="heroicons:trash" data-width="20"></span>批量删除
                        </button>
                    </div>
                    <div class="flex gap-4 mb-6">
                        <div class="join flex-1">
                            <input id="postSearchInput" type="text" placeholder="搜索帖子标题..." class="input input-bordered join-item flex-1" onkeypress="if(event.key==='Enter') performPostSearch()">
                            <button class="btn join-item btn-primary" onclick="performPostSearch()">
                                <span class="iconify" data-icon="heroicons:magnifying-glass" data-width="20"></span>
                            </button>
                        </div>
                        <select id="postStatusFilter" class="select select-bordered w-48" onchange="filterPostsByStatus(this.value)">
                            <option value="all">全部状态</option>
                            <option value="已发布">已发布</option>
                            <option value="草稿">草稿</option>
                        </select>
                    </div>
                    <div class="overflow-x-auto bg-base-100 rounded-lg shadow-soft border academic-border">
                        <table class="table">
                            <thead>
                                <tr class="bg-base-200">
                                    <th><input type="checkbox" class="checkbox checkbox-primary" id="postSelectAll" onchange="togglePostSelectAll(this)"></th>
                                    <th>帖子信息</th>
                                    <th>状态</th>
                                    <th>发布日期</th>
                                    <th>点赞数</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="postTableBody">
                                <tr><td colspan="6" class="text-center py-8 text-base-content/60">加载中...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- User Permission Section -->
                <div id="user-permission-section" class="content-section">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold text-base-content mb-2">用户权限管理</h1>
                        <p class="text-base-content/70">管理用户角色和权限</p>
                    </div>
                    <div class="alert alert-info"><span class="iconify" data-icon="heroicons:information-circle" data-width="20"></span>此功能仅管理员可用</div>
                </div>
                
                <!-- Forum Management Section -->
                <div id="forum-management-section" class="content-section">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold text-base-content mb-2">论坛管理</h1>
                        <p class="text-base-content/70">管理论坛帖子和评论</p>
                    </div>
                    <div class="alert alert-info"><span class="iconify" data-icon="heroicons:information-circle" data-width="20"></span>此功能仅管理员可用</div>
                </div>
            </div>
        </div>
        
        <!-- Upload Modal -->
        <dialog id="uploadModal" class="modal">
            <div class="modal-box">
                <h3 class="font-bold text-lg mb-4">上传图谱</h3>
                <form id="uploadForm" class="space-y-4">
                    <div class="form-control">
                        <label class="label"><span class="label-text">图谱文件 <span class="text-error">*</span></span></label>
                        <input type="file" id="graphFile" accept=".json" class="file-input file-input-bordered w-full" required>
                    </div>
                    <div class="form-control">
                        <label class="label"><span class="label-text">图谱名称</span></label>
                        <input type="text" id="graphName" placeholder="输入图谱名称" class="input input-bordered">
                    </div>
                    <div class="form-control">
                        <label class="label"><span class="label-text">描述</span></label>
                        <textarea id="graphDescription" placeholder="输入图谱描述" class="textarea textarea-bordered h-24"></textarea>
                    </div>
                    <div class="form-control">
                        <label class="label"><span class="label-text">状态</span></label>
                        <select id="graphStatus" class="select select-bordered">
                            <option value="DRAFT">草稿</option>
                            <option value="PUBLISHED">发布</option>
                            <option value="PRIVATE">私有</option>
                        </select>
                    </div>
                    <div class="form-control">
                        <label class="label"><span class="label-text">封面图片</span></label>
                        <input type="file" id="graphCover" accept="image/*" class="file-input file-input-bordered w-full" onchange="previewCover(this)">
                        <div id="coverPreview" class="hidden mt-2"><img id="coverPreviewImg" class="cover-preview" alt="封面预览"></div>
                    </div>
                </form>
                <div class="modal-action">
                    <button class="btn btn-ghost" onclick="closeUploadModal()">取消</button>
                    <button class="btn btn-primary" onclick="submitUploadForm()">上传</button>
                </div>
            </div>
            <form method="dialog" class="modal-backdrop"><button>close</button></form>
        </dialog>
        
        <!-- Edit Post Modal -->
        <dialog id="editPostModal" class="modal">
            <div class="modal-box">
                <h3 class="font-bold text-lg mb-4">编辑帖子</h3>
                <form id="editPostForm" class="space-y-4">
                    <input type="hidden" id="editPostId">
                    <div class="form-control">
                        <label class="label"><span class="label-text">帖子标题 <span class="text-error">*</span></span></label>
                        <input type="text" id="editPostTitle" class="input input-bordered" required>
                    </div>
                    <div class="form-control">
                        <label class="label"><span class="label-text">摘要</span></label>
                        <textarea id="editPostAbstract" class="textarea textarea-bordered h-24"></textarea>
                    </div>
                    <div class="form-control">
                        <label class="label"><span class="label-text">状态</span></label>
                        <select id="editPostStatus" class="select select-bordered">
                            <option value="草稿">草稿</option>
                            <option value="已发布">已发布</option>
                        </select>
                    </div>
                </form>
                <div class="modal-action">
                    <button class="btn btn-ghost" onclick="closeEditPostModal()">取消</button>
                    <button class="btn btn-primary" onclick="submitEditPost()">保存</button>
                </div>
            </div>
            <form method="dialog" class="modal-backdrop"><button>close</button></form>
        </dialog>
        
        <!-- Edit Modal -->
        <dialog id="editModal" class="modal">
            <div class="modal-box">
                <h3 class="font-bold text-lg mb-4">编辑图谱</h3>
                <form id="editForm" class="space-y-4">
                    <input type="hidden" id="editGraphId">
                    <div class="form-control">
                        <label class="label"><span class="label-text">图谱名称 <span class="text-error">*</span></span></label>
                        <input type="text" id="editGraphName" class="input input-bordered" required>
                    </div>
                    <div class="form-control">
                        <label class="label"><span class="label-text">描述</span></label>
                        <textarea id="editGraphDescription" class="textarea textarea-bordered h-24"></textarea>
                    </div>
                    <div class="form-control">
                        <label class="label"><span class="label-text">状态</span></label>
                        <select id="editGraphStatus" class="select select-bordered">
                            <option value="DRAFT">草稿</option>
                            <option value="PUBLISHED">已发布</option>
                            <option value="PRIVATE">私有</option>
                        </select>
                    </div>
                    <div class="form-control">
                        <label class="label"><span class="label-text">封面图片</span></label>
                        <div id="editCoverPreview" class="mb-2">
                            <img id="editCoverPreviewImg" class="w-full max-w-xs h-32 object-cover rounded-lg border" alt="当前封面">
                        </div>
                        <input type="file" id="editGraphCover" accept="image/*" class="file-input file-input-bordered w-full" onchange="previewEditCover(this)">
                        <p class="text-xs text-base-content/60 mt-1">上传新封面将覆盖当前封面，且不会被自动缩略图替换</p>
                    </div>
                </form>
                <div class="modal-action">
                    <button class="btn btn-ghost" onclick="closeEditModal()">取消</button>
                    <button class="btn btn-primary" onclick="submitEditForm()">保存</button>
                </div>
            </div>
            <form method="dialog" class="modal-backdrop"><button>close</button></form>
        </dialog>
    </div>

    <th:block layout:fragment="js">
        <script th:src="@{/js/dashboard.js}"></script>
    </th:block>
</body>

</html>
