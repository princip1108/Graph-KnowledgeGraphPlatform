# KnowledgeGraphPlatform 项目结构说明

> 知识图谱管理平台 - Graph+智汇星图

---

## 技术栈

| 层级 | 技术 |
|------|------|
| **前端模板** | Thymeleaf Layout Dialect + DaisyUI + TailwindCSS |
| **前端脚本** | 原生JavaScript（模块化）+ Force-Graph 力导向图库 |
| **后端框架** | Spring Boot 3.x |
| **关系数据库** | MySQL 8.0+ |
| **图数据库** | Neo4j 5.x |
| **安全框架** | Spring Security + OAuth2 第三方登录 |
| **邮件服务** | Spring Mail（邮箱验证码） |
| **序列化** | Jackson（自定义配置） |
| **构建工具** | Maven 3.8+ |
| **运行环境** | JDK 17+ |

---

## 目录结构

```
KnowledgeGraphPlatform/
├── demo/                              # 主工程目录
│   └── src/main/
│       ├── java/com/sdu/kgplatform/
│       │   ├── common/                # 通用工具类（2个）
│       │   ├── config/                # 配置类（10个）
│       │   ├── controller/            # 控制器层（16个）
│       │   ├── domain/                # 领域对象
│       │   │   └── dto/               # 领域DTO（2个）
│       │   ├── dto/                   # 数据传输对象（12个）
│       │   ├── entity/                # 实体类（41个）
│       │   ├── exception/             # 异常处理（2个）
│       │   ├── repository/            # 数据访问层（22个）
│       │   ├── security/              # 安全认证（3个）
│       │   ├── service/               # 业务逻辑层（15个）
│       │   │   └── impl/              # 服务接口实现（2个）
│       │   └── task/                  # 定时任务（1个）
│       └── resources/
│           ├── application.yaml       # 主配置文件
│           ├── application-local.yaml # 本地开发配置
│           ├── application-prod.yaml  # 生产环境配置
│           ├── static/
│           │   ├── assets/            # 静态资源（图片等）
│           │   ├── css/               # 样式文件（16个）
│           │   ├── js/                # JavaScript文件（15个）
│           │   │   └── graph/         # 图谱详情子模块（5个）
│           │   └── libs/              # 第三方库
│           │       └── force-graph/   # 力导向图渲染库
│           └── templates/
│               ├── layout/            # 布局模板
│               ├── fragments/         # 公共片段（6个）
│               ├── admin/             # 管理后台
│               ├── community/         # 社区论坛
│               ├── graph/             # 图谱相关
│               ├── pages/             # 静态页面
│               └── user/              # 用户相关
├── uploads/                           # 用户上传文件存储目录
└── 项目报告汇总/                       # 项目文档汇总
```

---

## 后端模块说明

### common/ — 通用工具类

| 文件 | 说明 |
|------|------|
| `SecurityUtils.java` | 安全工具类，提供获取当前登录用户ID、检查登录状态等静态方法 |
| `Result.java` | 统一API响应包装类，包含 `success`、`code`、`message`、`data`、`error` 字段 |

### config/ — 配置类

| 文件 | 说明 |
|------|------|
| `SecurityConfig.java` | Spring Security 安全配置，定义URL权限规则、登录/登出行为、OAuth2配置 |
| `Neo4jConfig.java` | Neo4j 图数据库连接配置 |
| `JpaConfig.java` | JPA 配置（MySQL 数据源、Hibernate 设置） |
| `WebConfig.java` | Web MVC 配置（静态资源映射、跨域设置等） |
| `JacksonConfig.java` | Jackson JSON 序列化/反序列化自定义配置 |
| `DatabaseInitializer.java` | 数据库初始化器，应用启动时自动创建默认角色、管理员账号等基础数据 |
| `GlobalModelAttributes.java` | 全局模型属性，向所有 Thymeleaf 模板注入公共数据（如当前用户信息） |
| `LoginSuccessHandler.java` | 表单登录成功处理器，处理登录成功后的跳转逻辑 |
| `LoginFailureHandler.java` | 表单登录失败处理器，处理登录失败后的错误提示 |
| `OAuth2LoginSuccessHandler.java` | OAuth2 第三方登录成功处理器，处理 GitHub/Gitee 等第三方登录回调 |

### controller/ — 控制器层

| 文件 | 请求映射 | 说明 |
|------|---------|------|
| `PageController.java` | 各页面路由 | 页面路由控制器，处理所有前端页面的URL映射（`@Controller`） |
| `AuthController.java` | `/auth/*` | 认证控制器，处理注册、登录、邮箱验证、密码重置（`@Controller`） |
| `UserController.java` | `/user/*` | 用户管理控制器，处理个人资料查看/编辑、关注/取关、头像上传（`@Controller`） |
| `GraphController.java` | `/api/graph/*` | 图谱管理控制器，处理图谱CRUD、公开列表、搜索、推荐、收藏、统计 |
| `NodeController.java` | `/api/graph/{graphId}/*` | 节点与关系控制器，处理图谱内节点/关系的增删改查、批量操作 |
| `PostController.java` | `/api/*` | 帖子管理控制器，处理帖子CRUD、点赞、置顶、分页列表 |
| `CommentController.java` | `/api/*` | 评论控制器，处理帖子评论的发布、删除、分页查询 |
| `FileUploadController.java` | `/api/upload/*` | 文件上传控制器，处理图谱文件（JSON/CSV）及图片上传 |
| `DownloadController.java` | `/api/download/*` | 图谱下载控制器，支持 JSON、CSV、PNG 三种格式导出 |
| `CategoryController.java` | `/api/category/*` | 图谱分类控制器，处理分类的CRUD |
| `DomainCategoryController.java` | `/api/categories/*` | 领域分类控制器，提供领域分类列表查询 |
| `AnnouncementController.java` | `/api/announcements/*` | 论坛公告控制器，处理公告的发布、查询、删除 |
| `MessageController.java` | `/api/messages/*` | 站内信控制器，处理消息的发送、查询、标记已读 |
| `HistoryController.java` | `/api/history/*` | 浏览/搜索历史控制器，记录和查询用户浏览足迹与搜索记录 |
| `FeedbackController.java` | `/api/feedback/*` | 用户反馈控制器，处理意见反馈的提交和查询 |
| `AdminController.java` | `/api/admin/*` | 管理后台控制器（需管理员权限），处理用户管理、内容审核、系统统计 |

### dto/ — 数据传输对象

| 文件 | 说明 |
|------|------|
| `GraphDetailDto.java` | 图谱详情DTO，包含完整图谱信息（含质量指标、统计数据、上传者信息） |
| `GraphListDto.java` | 图谱列表DTO，用于列表展示的简化信息（含节点数、关系数、密度、下载数等） |
| `GraphCreateDto.java` | 图谱创建DTO，封装创建图谱时的请求参数 |
| `GraphUpdateDto.java` | 图谱更新DTO，封装更新图谱信息时的请求参数 |
| `GraphImportDto.java` | 图谱导入DTO，封装文件导入图谱时的参数（格式、映射规则等） |
| `GraphSearchCriteria.java` | 图谱高级搜索条件DTO，支持按节点数/关系数/密度/浏览数/日期等多维筛选 |
| `NodeDto.java` | 节点DTO，完整节点信息 |
| `LiteNodeDto.java` | 轻量节点DTO，用于图谱可视化时的精简节点数据 |
| `RelationshipDto.java` | 关系DTO，完整关系信息 |
| `LiteRelationshipDto.java` | 轻量关系DTO，用于图谱可视化时的精简关系数据 |
| `UserProfileDto.java` | 用户资料DTO，封装个人中心展示所需的用户信息 |
| `UserRegistrationDto.java` | 用户注册DTO，封装注册请求参数（用户名、邮箱、密码、验证码等） |

### domain/dto/ — 领域DTO

| 文件 | 说明 |
|------|------|
| `BrowsingHistoryDto.java` | 浏览历史DTO，封装浏览记录的展示数据 |
| `ConversationDto.java` | 会话DTO，封装站内信会话列表的展示数据 |

### entity/ — 实体类

#### MySQL 核心业务实体

| 文件 | 对应表 | 说明 |
|------|--------|------|
| `KnowledgeGraph.java` | `knowledge_graph` | 知识图谱元数据（名称、描述、节点数、关系数、密度、热度分等） |
| `User.java` | `users` | 用户信息（用户名、邮箱、密码、头像、简介等） |
| `Post.java` | `posts` | 论坛帖子（标题、摘要、正文、点赞数、分类等） |
| `Comment.java` | `comments` | 帖子评论（内容、发布时间、所属帖子、作者等） |
| `Category.java` | `categories` | 图谱分类信息 |
| `DomainCategory.java` | `domain_categories` | 领域分类（图谱所属领域） |
| `Tag.java` | `tags` | 标签实体 |
| `Announcement.java` | `announcements` | 论坛公告 |
| `Message.java` | `messages` | 站内私信 |
| `TeamMember.java` | `team_members` | 团队成员信息（关于页面展示） |

#### MySQL 用户行为实体

| 文件 | 对应表 | 说明 |
|------|--------|------|
| `PostLike.java` / `PostLikeId.java` | `post_likes` | 帖子点赞（联合主键：用户ID+帖子ID） |
| `PostFavorite.java` / `PostFavoriteId.java` | `post_favorites` | 帖子收藏 |
| `GraphFavorite.java` / `GraphFavoriteId.java` | `graph_favorites` | 图谱收藏 |
| `UserFollow.java` / `UserFollowId.java` | `user_follows` | 用户关注关系 |
| `BrowsingHistory.java` | `browsing_history` | 用户浏览历史记录 |
| `SearchHistory.java` | `search_history` | 用户搜索历史记录 |
| `UserFeedback.java` | `user_feedback` | 用户反馈意见 |
| `OauthAccount.java` | `oauth_accounts` | 第三方OAuth账号绑定记录 |
| `EmailVerificationCode.java` | `email_verification_codes` | 邮箱验证码 |

#### MySQL 关联表实体

| 文件 | 对应表 | 说明 |
|------|--------|------|
| `GraphTag.java` / `GraphTagId.java` | `graph_tags` | 图谱-标签关联 |
| `PostTag.java` / `PostTagId.java` | `post_tags` | 帖子-标签关联 |
| `UserTag.java` / `UserTagId.java` | `user_tags` | 用户-兴趣标签关联 |
| `UserRole.java` / `UserRoleId.java` | `user_roles` | 用户-角色关联 |
| `RolePerm.java` / `RolePermId.java` | `role_perms` | 角色-权限关联 |

#### MySQL 权限与角色实体

| 文件 | 说明 |
|------|------|
| `Role.java` | 角色实体（如 USER、ADMIN） |
| `Roles.java` | 角色枚举常量 |
| `Perm.java` | 权限实体 |

#### 枚举类型

| 文件 | 说明 |
|------|------|
| `GraphStatus.java` | 图谱状态枚举（DRAFT草稿、PUBLISHED已发布等） |
| `CachedFileFormat.java` | 缓存文件格式枚举（JSON、CSV等） |
| `PostStatus.java` | 帖子状态枚举 |
| `MessageStatus.java` | 消息状态枚举（已读/未读） |
| `AnnouncementType.java` | 公告类型枚举 |
| `Gender.java` | 性别枚举 |
| `PlatformName.java` | OAuth平台名称枚举（GITHUB、GITEE等） |
| `ResourceType.java` | 资源类型枚举 |
| `UserStatus.java` | 用户状态枚举（正常、禁用等） |

#### Neo4j 图数据库实体

| 文件 | 说明 |
|------|------|
| `NodeEntity.java` | 图谱节点（`:Entity` 标签），包含 nodeId、graphId、name、type、description 等属性 |
| `RelationshipEntity.java` | 图谱关系（`[:RELATES_TO]`），包含 type、graphId 等属性 |

### exception/ — 异常处理

| 文件 | 说明 |
|------|------|
| `BusinessException.java` | 业务异常基类，用于抛出带有错误码和消息的业务异常 |
| `GlobalExceptionHandler.java` | 全局异常处理器（`@ControllerAdvice`），统一捕获并格式化异常响应 |

### repository/ — 数据访问层

| 文件 | 说明 |
|------|------|
| `KnowledgeGraphRepository.java` | 图谱仓库（MySQL JPA），提供图谱的分页查询、热门排序、推荐查询等 |
| `NodeRepository.java` | 节点仓库（Neo4j），提供节点的CRUD、按图谱查询、模糊搜索等 |
| `RelationshipRepository.java` | 关系仓库（Neo4j），提供关系的CRUD、按图谱查询等 |
| `GraphSpecification.java` | 图谱动态查询规格（JPA Specification），支持多条件组合筛选 |
| `UserRepository.java` | 用户仓库，提供按用户名/邮箱查询等 |
| `PostRepository.java` | 帖子仓库，提供分页查询、按分类/状态筛选等 |
| `CommentRepository.java` | 评论仓库，提供按帖子查询评论列表、评论数统计等 |
| `PostLikeRepository.java` | 帖子点赞仓库 |
| `PostFavoriteRepository.java` | 帖子收藏仓库 |
| `PostTagRepository.java` | 帖子标签关联仓库 |
| `GraphFavoriteRepository.java` | 图谱收藏仓库 |
| `CategoryRepository.java` | 分类仓库 |
| `DomainCategoryRepository.java` | 领域分类仓库 |
| `TagRepository.java` | 标签仓库 |
| `AnnouncementRepository.java` | 公告仓库 |
| `MessageRepository.java` | 站内信仓库 |
| `BrowsingHistoryRepository.java` | 浏览历史仓库 |
| `SearchHistoryRepository.java` | 搜索历史仓库 |
| `UserFollowRepository.java` | 用户关注仓库 |
| `FeedbackRepository.java` | 用户反馈仓库 |
| `EmailVerificationCodeRepository.java` | 邮箱验证码仓库 |
| `OauthAccountRepository.java` | OAuth第三方账号仓库 |

### security/ — 安全认证

| 文件 | 说明 |
|------|------|
| `CustomUserDetails.java` | 自定义 UserDetails 实现，封装登录用户的认证信息（用户ID、角色等） |
| `CustomOAuth2User.java` | 自定义 OAuth2User 实现，封装第三方登录用户的信息 |
| `CustomOAuth2UserService.java` | 自定义 OAuth2 用户服务，处理第三方登录时的用户加载与账号绑定逻辑 |

### service/ — 业务逻辑层

| 文件 | 说明 |
|------|------|
| `GraphService.java` | 图谱业务逻辑，包含图谱CRUD、公开列表查询、搜索、个性化推荐、热度排序、收藏管理等 |
| `NodeService.java` | 节点业务逻辑，包含节点CRUD、批量操作、图谱数据可视化转换等 |
| `RelationshipService.java` | 关系业务逻辑，包含关系CRUD、批量操作等 |
| `UserService.java` | 用户业务逻辑，包含注册、登录认证、资料编辑、关注管理等 |
| `PostService.java` | 帖子业务逻辑，包含帖子CRUD、点赞/取消点赞、热门帖子等 |
| `CommentService.java` | 评论业务逻辑，包含评论发布、删除、分页查询等 |
| `AdminService.java` | 管理后台业务逻辑，包含用户管理、内容审核、系统统计等 |
| `CategoryService.java` | 分类业务逻辑 |
| `FileStorageService.java` | 文件存储服务接口，定义文件上传、存储、删除的抽象方法 |
| `GraphImportService.java` | 图谱导入服务接口，定义文件解析与图谱导入的抽象方法 |
| `EmailService.java` | 邮件发送服务，负责发送验证码、通知邮件等 |
| `EmailVerificationService.java` | 邮箱验证服务，负责验证码的生成、存储、校验 |
| `HistoryService.java` | 历史记录服务，负责浏览历史和搜索历史的记录与查询 |
| `MessageService.java` | 站内信服务，负责消息的发送、查询、标记已读等 |
| `FeedbackService.java` | 用户反馈服务，负责反馈的提交与管理 |

### service/impl/ — 服务实现

| 文件 | 说明 |
|------|------|
| `FileStorageServiceImpl.java` | 文件存储服务实现，处理本地磁盘文件的保存和路径管理 |
| `GraphImportServiceImpl.java` | 图谱导入服务实现，支持 JSON/CSV 格式解析并批量写入 Neo4j |

### task/ — 定时任务

| 文件 | 说明 |
|------|------|
| `GraphHotScoreTask.java` | 图谱热度分数定时计算任务，定期根据浏览量、收藏量、下载量等指标更新图谱的 hotScore |

---

## 前端模块说明

### templates/layout/ — 布局模板

| 文件 | 说明 |
|------|------|
| `base.html` | 基础布局模板，所有页面通过 `layout:decorate` 继承此模板，包含公共头部、导航栏、页脚 |

### templates/fragments/ — 公共片段

| 文件 | 说明 |
|------|------|
| `header.html` | 导航栏片段，包含主导航、用户菜单、搜索框、消息通知等 |
| `footer.html` | 页脚片段，包含版权信息、链接等 |
| `sidebar.html` | 侧边栏片段，用于管理后台等页面的侧边导航 |
| `graph-modals.html` | 图谱相关的公共弹窗片段（如创建图谱、导入图谱等模态框） |
| `common_styles.html` | 公共样式引用片段，统一引入 TailwindCSS、DaisyUI 等 |
| `common_scripts.html` | 公共脚本引用片段，统一引入 Iconify、公共JS等 |

### templates/ — 页面模板

| 目录 | 页面 | 说明 |
|------|------|------|
| **admin/** | `dashboard.html` | 管理后台仪表盘，包含系统统计、用户管理、内容审核等功能 |
| **community/** | `forum_list.html` | 论坛列表页，展示帖子列表、分类筛选、搜索、公告等 |
| | `post_detail.html` | 帖子详情页，展示帖子正文、评论列表、点赞/收藏 |
| | `post_edit.html` | 帖子编辑页，富文本编辑器、标签选择、发布/保存草稿 |
| | `feedback.html` | 意见反馈页，用户提交问题和建议 |
| **graph/** | `home.html` | 首页，展示推荐图谱、热门图谱、搜索入口、平台介绍 |
| | `graph_list.html` | 图谱探索页，展示图谱卡片列表、多维筛选（结构/热度/领域）、排序 |
| | `graph_detail.html` | 图谱详情页，包含图谱可视化、节点/关系管理、统计指标、下载导出 |
| **pages/** | `about.html` | 关于页面，展示平台介绍和团队成员信息 |
| | `documentation.html` | 使用文档页面，展示平台使用指南 |
| | `privacy.html` | 隐私政策页面 |
| | `terms.html` | 服务条款页面 |
| **user/** | `login_register.html` | 登录/注册页面，支持表单登录、邮箱注册、OAuth2第三方登录 |
| | `profile.html` | 个人中心页面，展示/编辑个人资料、我的图谱、收藏、关注等 |
| | `password_reset.html` | 密码重置页面，通过邮箱验证码重置密码 |
| | `registration_success.html` | 注册成功页面 |

### static/js/ — JavaScript 模块

| 文件 | 说明 |
|------|------|
| `home.js` | 首页逻辑，处理推荐图谱加载、搜索跳转、热门图谱轮播等 |
| `graph-list.js` | 图谱列表页逻辑，处理图谱加载、多维筛选（节点数/关系数/密度/浏览数/下载数）、排序、收藏 |
| `graph-detail-page.js` | 图谱详情页主逻辑，协调各子模块，处理页面初始化、统计指标计算 |
| `forum-list.js` | 论坛列表页逻辑，处理帖子列表渲染、分类筛选、搜索、点赞 |
| `post-detail.js` | 帖子详情页逻辑，处理评论加载/发布、点赞/收藏 |
| `post-edit.js` | 帖子编辑页逻辑，处理富文本编辑、标签管理、发布/保存草稿 |
| `profile.js` | 个人中心页逻辑，处理资料编辑、我的图谱管理、收藏列表、关注列表 |
| `dashboard.js` | 管理后台逻辑，处理统计图表、用户管理、内容审核操作 |
| `login-register.js` | 登录注册页逻辑，处理表单验证、注册流程、验证码发送 |
| `password-reset.js` | 密码重置页逻辑，处理邮箱验证和密码修改 |
| `feedback.js` | 反馈页逻辑，处理反馈表单提交 |
| `about.js` | 关于页逻辑，处理团队成员展示等动态内容 |
| `documentation.js` | 文档页逻辑，处理目录导航、内容切换等 |
| `guest-utils.js` | 游客工具函数，处理未登录用户的功能限制提示和登录引导 |
| `test_check.js` | 测试检查脚本 |

### static/js/graph/ — 图谱详情子模块

| 文件 | 说明 |
|------|------|
| `graph-detail-core.js` | 图谱核心功能，负责 Force-Graph 力导向图渲染、节点/关系可视化、交互操作 |
| `graph-detail-search.js` | 图谱搜索功能，支持按名称/类型搜索节点，高亮定位 |
| `graph-detail-query.js` | 图谱查询功能，支持路径查询、邻居查询等图论操作 |
| `graph-detail-edit.js` | 图谱编辑功能，支持节点/关系的可视化增删改 |
| `graph-bindao.js` | 图谱编辑辅助模块 |
| `graph-bindao-bindao.js` | 图谱编辑辅助模块（扩展） |

### static/css/ — 样式文件

| 文件 | 说明 |
|------|------|
| `home.css` | 首页样式 |
| `graph-list.css` | 图谱列表页样式（含筛选面板、图谱卡片、滑动条等） |
| `graph-detail.css` | 图谱详情页样式（含图谱画布、侧边面板、工具栏等） |
| `forum-list.css` | 论坛列表页样式 |
| `post-detail.css` | 帖子详情页样式 |
| `post-edit.css` | 帖子编辑页样式 |
| `profile.css` | 个人中心页样式 |
| `dashboard.css` | 管理后台样式 |
| `login-register.css` | 登录注册页样式 |
| `password-reset.css` | 密码重置页样式 |
| `registration-success.css` | 注册成功页样式 |
| `feedback.css` | 反馈页样式 |
| `about.css` | 关于页样式 |
| `documentation.css` | 文档页样式 |
| `privacy.css` | 隐私政策页样式 |
| `terms.css` | 服务条款页样式 |

### static/libs/ — 第三方库

| 目录/文件 | 说明 |
|-----------|------|
| `force-graph/force-graph.min.js` | Force-Graph 力导向图渲染库，用于图谱详情页的可视化展示 |

### static/assets/ — 静态资源

| 目录 | 说明 |
|------|------|
| `images/` | 平台图片资源（Logo、默认头像、封面占位图等） |
| `js/` | 其他辅助JS资源 |
| `3/` | 第三方静态资源 |

---

## 前端模板规范

所有页面均使用 Thymeleaf Layout Dialect 继承 `layout/base.html`：

```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
    <title>页面标题 - GraphWisdom智汇星图</title>
    <th:block layout:fragment="css">
        <!-- 页面特定CSS -->
    </th:block>
</head>
<body>
    <div layout:fragment="content">
        <!-- 页面内容 -->
    </div>
    <th:block layout:fragment="js">
        <!-- 页面特定JS -->
    </th:block>
</body>
</html>
```

---

## API 响应格式

### 统一包装格式（Result）

成功响应：

```json
{
    "success": true,
    "code": 200,
    "message": "操作成功",
    "data": { ... },
    "error": null
}
```

错误响应：

```json
{
    "success": false,
    "code": 400,
    "message": null,
    "data": null,
    "error": "错误信息"
}
```

### 分页响应格式

图谱列表、帖子列表等分页接口返回：

```json
{
    "content": [ ... ],
    "totalElements": 100,
    "totalPages": 10,
    "currentPage": 0
}
```

---

## 数据库设计

### MySQL 表

#### 核心业务表

- `knowledge_graph` — 知识图谱元数据表（名称、描述、状态、节点数、关系数、密度、热度分等）
- `users` — 用户表（用户名、邮箱、密码哈希、头像、简介、状态等）
- `posts` — 帖子表（标题、摘要、正文、点赞数、作者、分类、状态等）
- `comments` — 评论表（内容、发布时间、所属帖子、作者等）
- `categories` — 分类表
- `domain_categories` — 领域分类表
- `tags` — 标签表
- `announcements` — 论坛公告表
- `messages` — 站内私信表
- `team_members` — 团队成员表

#### 用户行为表

- `post_likes` — 帖子点赞表（联合主键：用户ID+帖子ID）
- `post_favorites` — 帖子收藏表
- `graph_favorites` — 图谱收藏表
- `user_follows` — 用户关注关系表
- `browsing_history` — 浏览历史表（用于个性化推荐）
- `search_history` — 搜索历史表
- `user_feedback` — 用户反馈表
- `email_verification_codes` — 邮箱验证码表
- `oauth_accounts` — 第三方OAuth账号绑定表

#### 关联表

- `graph_tags` — 图谱-标签关联表
- `post_tags` — 帖子-标签关联表
- `user_tags` — 用户-兴趣标签关联表
- `user_roles` — 用户-角色关联表
- `role_perms` — 角色-权限关联表
- `roles` — 角色表
- `perms` — 权限表

### Neo4j 图数据库

- `:Entity` — 图谱节点
  - `nodeId` — 节点业务ID
  - `graphId` — 所属图谱ID
  - `name` — 节点名称
  - `type` — 节点类型
  - `description` — 节点描述
  - `properties` — 扩展属性（Map）

- `[:RELATES_TO]` — 节点关系
  - `type` — 关系类型
  - `graphId` — 所属图谱ID

---

## 启动说明

### 环境要求

- JDK 17+
- MySQL 8.0+
- Neo4j 5.x
- Maven 3.8+

### 配置文件

项目使用多环境配置：

| 文件 | 说明 |
|------|------|
| `application.yaml` | 主配置文件，定义通用配置和默认激活环境 |
| `application-local.yaml` | 本地开发环境配置（数据库地址、端口等） |
| `application-prod.yaml` | 生产环境配置 |

核心配置项：

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/kgplatform
    username: root
    password: your_password
  neo4j:
    uri: bolt://localhost:7687
    authentication:
      username: neo4j
      password: your_password
  mail:
    host: smtp.example.com
    username: your_email
    password: your_email_password
```

### 启动命令

```bash
cd demo
mvn spring-boot:run
```

访问 http://localhost:8080

---

## 开发规范

### 后端规范

1. **依赖注入**：使用构造器注入（`@RequiredArgsConstructor` 或显式构造函数）
2. **日志记录**：使用 SLF4J Logger，禁止 `System.out.println`
3. **异常处理**：使用 `BusinessException` + `GlobalExceptionHandler` 统一处理
4. **响应格式**：使用 `Result<T>` 统一包装API响应
5. **实体命名**：联合主键使用独立的 `XxxId` 类（如 `PostLikeId`）
6. **分层职责**：Controller 只做参数校验和权限检查，业务逻辑放在 Service 层

### 前端规范

1. **模板继承**：所有页面使用 `layout:decorate` 继承 `base.html`
2. **JS模块化**：每个页面对应独立的JS文件，图谱详情页进一步拆分为子模块
3. **URL引用**：使用 `th:href` 和 `th:src` 确保路径正确
4. **样式隔离**：每个页面对应独立的CSS文件，避免全局样式污染
5. **HTML实体编码**：Thymeleaf模板内的JavaScript代码中，特殊字符须使用HTML实体编码（`&gt;`、`&#39;` 等）

---

*文档更新：2026-02-13*
