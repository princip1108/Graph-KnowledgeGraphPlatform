# 全栈模块化详细实施方案

# 1. 总体目标
将当前的单体应用（Spring Boot + 静态 HTML）重构为现代化的前后端分离架构。
- **后端**: 采用 Maven 多模块架构，清晰划分职责。
- **前端**: 迁移至 **Vue 3 (Composition API) + Vite**，实现组件化开发。

## 关键技术选型
- **后端**:
    - **Java**: 21 (沿用)
    - **Spring Boot**: 推荐使用 Stable 版本 (如 3.3.x)，当前 `pom.xml` 中的 `4.0.0` 可能是笔误或预发布版，建议修正。
    - **数据库**: MySQL 8.0 + Neo4j 5.x
- **前端**:
    - **框架**: Vue 3.4+
    - **构建工具**: Vite 5.x
    - **UI 组件库**: Element Plus (适合管理后台) 或 PrimeVue / Ant Design Vue。鉴于原项目使用了 Tailwind，推荐 **Tailwind CSS + Headless UI** 或 **Element Plus** 混用。考虑到开发效率，本方案采用 **Element Plus** 作为主要 UI 库。
    - **状态管理**: Pinia
    - **路由**: Vue Router 4
    - **网络请求**: Axios

---

# 2. 后端重构方案 (Maven 多模块)

## 2.1 模块结构设计

根项目名建议修改为 `kg-platform-parent`。

| 模块名称 | 职责描述 | 关键依赖 |
| :--- | :--- | :--- |
| **`kg-common`** | 通用工具层。包含全局常量、`Result<T>` 统一响应封装、自定义异常、DateUtils 等工具类。 | Lombok, Hutool, Jackson, Commons-Lang3 |
| **`kg-model`** | 数据模型层。包含所有 JPA Entity, Neo4j NodeEntity, DTO (Data Transfer Object), VO (View Object), Enums。 | `kg-common`, Spring Data JPA, Spring Data Neo4j |
| **`kg-repository`** | 数据访问层。包含 Repository 接口。 | `kg-model` |
| **`kg-service`** | 业务逻辑层。包含 Service 接口及其实现类 (`impl`)。事务控制在此层。 | `kg-repository` |
| **`kg-web`** | 接入层/启动层。包含 Controller, GlobalExceptionHandler, SecurityConfig, WebConfig, 以及 `Application` 启动类。 | `kg-service`, Spring Boot Starter Web, Security |

## 2.2 迁移详细步骤

1.  **初始化父工程**: 创建 `pom.xml`，定义 `<packaging>pom</packaging>`，在 `<dependencyManagement>` 中统一管理 Spring Boot 和各子模块版本。
2.  **创建子模块**: 依次创建上述 5 个模块。
3.  **代码迁移 (按依赖顺序)**:
    -   **Phase 1 (`kg-common`)**: 迁移/创建 `Result` 类, `ErrorCode` 枚举。
    -   **Phase 2 (`kg-model`)**: 迁移 `com.sdu.kgplatform.entity` 下的所有类。将 JPA 注解 (`@Entity`) 和 Neo4j 注解 (`@Node`) 保留。迁移 `dto` 包。
    -   **Phase 3 (`kg-repository`)**: 迁移 `repository` 包。确保 `JpaRepository` 和 `Neo4jRepository` 引用的实体路径正确。
    -   **Phase 4 (`kg-service`)**: 迁移 `service` 包。注意修正 `import` 语句。
    -   **Phase 5 (`kg-web`)**: 迁移 `controller` 和 `config` 包。
        -   **重点**: `SecurityConfig` 需要重新检查，确保静态资源拦截规则（如果前端分离，后端不再托管静态资源，只需放行 API）。
4.  **配置迁移**:
    -   将 `application.yaml` 移动到 `kg-web/src/main/resources`。

---

# 3. 前端重构方案 (Vue 3 + Vite)

## 3.1 目录结构 (`kg-ui`)

```text
kg-ui/
├── public/              # 静态资源 (favicon, robots.txt)
├── src/
│   ├── api/             # API 接口统一管理 (account.js, graph.js)
│   ├── assets/          # 项目静态资源 (images, global css)
│   ├── components/      # 公共组件 (Header.vue, Footer.vue)
│   ├── layout/          # 布局组件 (BasicLayout.vue - 含侧边栏/顶栏)
│   ├── router/          # 路由配置 (index.js)
│   ├── stores/          # Pinia 状态管理 (userStore.js - 存 token)
│   ├── utils/           # 工具函数 (request.js - axios 拦截器)
│   ├── views/           # 页面级组件
│   │   ├── auth/        # 登录注册 (Login.vue, Register.vue)
│   │   ├── home/        # 首页 (Home.vue)
│   │   ├── graph/       # 图谱相关 (GraphList.vue, GraphDetail.vue)
│   │   ├── user/        # 个人中心 (Profile.vue)
│   │   └── admin/       # 后台管理 (AdminDashboard.vue)
│   ├── App.vue          # 根组件
│   └── main.js          # 入口文件
├── index.html           # Vite 入口
├── package.json
└── vite.config.js
```

## 3.2 页面拆分与迁移策略

您现有的 HTML 页面将被拆分为 Vue 视图和组件：

| 原 HTML 文件 | 新 Vue 组件 (src/views/...) | 备注 |
| :--- | :--- | :--- |
| `首页.html` | `home/Home.vue` | 提取顶部导航为 `components/NavBar.vue` |
| `登录注册.html` | `auth/Login.vue` | 可能需要拆分为登录和注册两个 Tab 或 页面 |
| `找回密码.html` | `auth/ForgotPassword.vue` | |
| `图谱列表页.html` | `graph/GraphList.vue` | 列表项提取为 `GraphCard.vue` |
| `图谱详情页.html` | `graph/GraphDetail.vue` | 核心是图谱可视化组件，需引入 D3.js 或 ECharts (或沿用原 JS 逻辑封装) |
| `个人中心.html` | `user/Profile.vue` | |
| `管理.html` | `admin/Dashboard.vue` | 建议使用 Layout 布局，包含侧边栏菜单 |
| `论坛.html` | `community/Forum.vue` | |

## 3.3 关键逻辑迁移
1.  **API 请求**: 原生 `fetch`/`ajax` 替换为封装好的 `src/utils/request.js` (Axios 实例)。
    -   配置 Response 拦截器：自动处理 401 未登录，统一弹出错误提示。
2.  **认证状态**: 使用 Pinia `useUserStore()` 存储 JWT Token 和用户信息。
3.  **图谱可视化**: 原项目中用于渲染图谱的 JS 代码（可能是 D3.js 或其他库）需要被封装进 Vue 组件 (`components/GraphVisualizer.vue`)，在 `onMounted` 生命周期中初始化。

# 验证与测试
1.  **启动后端**: `mvn clean install` -> 运行 `kg-web` -> 端口 8080。
2.  **启动前端**: `npm run dev` -> 端口 5173。
3.  **配置代理**: 在 `vite.config.js` 中配置 `server.proxy`，将 `/api` 请求转发到 `localhost:8080`，解决跨域问题。
