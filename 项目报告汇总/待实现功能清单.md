# 项目未实现功能与技术债务分析

通过对现有代码库的深入分析，我们发现项目虽然核心功能（图谱CRUD、基础社区）已初步实现，但在工程化、扩展性和高级功能方面仍有大量缺失。

## 1. 核心未实现/不完整功能

### 1.1 图谱统计更新不完整
- **现状**: `GraphService.updateGraphStats` 方法中包含注释 `// 关系数需要 RelationshipRepository，暂时跳过`。
- **影响**: 图谱的关系数量（`relationCount`）可能不会正确更新，导致统计数据不准。虽然 `RelationshipRepository` 已存在，但未被 Service 层正确调用。

### 1.2 社交与互动功能严重缺失（"僵尸"实体）
- **私信系统 (Private Messaging)**:
    - **现状**: 存在 `Message` 实体，但**完全没有任何** `Controller`、`Service` 或 `Repository` 代码。
    - **影响**: 用户无法发送私信，前端的“发消息”按钮如果存在也将是无效的。
- **用户反馈 (User Feedback)**:
    - **现状**: 存在 `UserFeedback` 实体，但无后端逻辑支持。
    - **影响**: 用户无法提交反馈，管理员无法查看反馈。
- **历史记录 (History Tracking)**:
    - **现状**: 存在 `BrowsingHistory` 和 `SearchHistory` 实体，但无代码进行记录或查询。
    - **影响**: “最近浏览”和“搜索历史”功能无法实现。

### 1.3 搜索功能简陋
- **现状**: `KnowledgeGraphRepository` 使用 SQL `LIKE` 语句进行搜索 (`searchPublicGraphs`)。
- **缺失**: 缺乏真正的全文检索（如 Elasticsearch），在数据量大时性能会急剧下降，且不支持高级搜索（分词、拼音、纠错）。

### 1.3 推荐系统缺失
- **现状**: 所谓的“推荐” (`getPopularGraphs`) 仅仅是按浏览量 (`viewCount`) 倒序排列。
- **缺失**: 没有协同过滤或基于内容的推荐算法，无法实现个性化推荐。

### 1.4 图谱高级算法
- **现状**: 目前仅支持基础的节点/关系增删查改。
- **缺失**: 缺少图计算功能，如最短路径、不仅中心性、社区发现算法等 Neo4j 的强项功能未被暴露给 API。

### 1.5 数据导出/缓存逻辑存疑
- **现状**: `KnowledgeGraph` 实体包含 `cachedFilePath`，但未发现完善的后台定时任务来生成这些缓存文件。
- **风险**: 如果没有自动生成机制，下载功能可能无法按照预期工作。

## 2. 关键技术债务 (Technical Debt)


### 2.2 测试覆盖率极低
- **现状**: `src/test` 目录下仅有极其基础的生成的测试类，几乎没有单元测试和集成测试。
- **风险**: 重构（如即将进行的模块化）极易引入回归 Bug，且无法自动化验证。

### 2.3 日志管理缺失
- **现状**: 代码中大量使用 `System.err.println` 和 `printStackTrace`。
- **建议**: 应引入 Slf4j + Logback/Log4j2，并配置日志分级和文件滚动策略。

### 2.4 API 文档缺失
- **现状**: 无论是 Swagger 还是 OpenAPI 均未集成。
- **影响**: 前后端对接完全依赖口头沟通或阅读代码，维护成本高。

### 2.5 安全认证机制传统
- **现状**: 使用基于 Session 的 Cookie 认证 (`formLogin`)。
- **建议**: 对于前后端分离架构（特别是计划迁移到 Vue 3），建议迁移到 **JWT (JSON Web Token)** 无状态认证。

## 3. 下一步建议

建议在进行 **模块化重构** 的同时，解决上述核心技术债务：

1.  **修正 POM 版本**：降级到稳定的 Spring Boot 3.2.x 或 3.3.x。
2.  **补全 API 文档**：引入 `springdoc-openapi`。
3.  **集成 JWT**：替换当前的 Session 登录。
4.  **补全统计逻辑**：在 `GraphService` 中正确注入并使用 `RelationshipRepository`。

这份清单已整理至我们的工作队列中，将在重构阶段逐步解决。

## 4. AI 功能集成规划 (Proposed AI Features)
**状态**: 规划中 (Proposed)

结合 KnowlegeGraph 与 LLM，我们规划了以下 AI 增强功能：

### 4.1 核心方案 (High Priority)
- **AI 知识构建助手 (The Builder)**:
    - Text-to-Graph: 上传文本/PDF，自动提取实体关系生成图谱。
    - 解决“冷启动”问题，快速填充数据库。
- **AI 质检员 (The Curator)**:
    - 在上传阶段介入，自动修复语义矛盾、补全缺失属性（如人物生卒年）。
- **叙事讲述者 (The Storyteller)**:
    - 选中图谱路径，AI 自动生成自然语言故事，降低阅读门槛。

### 4.2 进阶交互 (Advanced)
- **自然语言渲染师 (The Stylist)**: “把重要人物变红” —— 语音控制图谱样式。
- **GraphRAG 对话**: 基于图谱的智能问答。

## 5. 性能优化方案 (Performance Optimization)
**状态**: 待执行 (Pending)

针对查询慢的问题，诊断发现以下瓶颈：

### 5.1 数据库索引缺失 (Critical)
Neo4j 中缺失 `graphId` 索引，导致全表扫描。
- **修复**: 需执行 `CREATE INDEX entity_graph_id_index FOR (n:Entity) ON (n.graphId);`

### 5.2 API 数据传输冗余 (Over-fetching)
`RelationshipRepository` 返回整个节点对象而非 ID。
- **修复**: 修改 Cypher 查询，只返回 `Projection` (relationId, sourceId, targetId, type)。

### 5.3 缓存策略
- 引入 **Redis** 缓存热点图谱数据。
- 前端实现**懒加载**和请求**并行化**。
