# 推荐功能修复与升级方案

## 目标
1.  **修复 Bug**: 解决首页和列表页“推荐”实际显示为“最新”的问题。
2.  **新增特性**: 实现基于“Hacker News 重力算法”的热度推荐功能。

## 数据库变更 (自动处理)
项目配置了 `spring.jpa.hibernate.ddl-auto: update`，因此只需修改 Java 实体类，应用启动时会自动在数据库表中添加 `hot_score` 字段。

**无需手动执行 SQL，但为了安全性，生成的 SQL 如下：**
```sql
ALTER TABLE `knowledge_graph` ADD COLUMN `hot_score` DOUBLE DEFAULT 0.0;
CREATE INDEX `idx_hot_score` ON `knowledge_graph` (`hot_score`);
```

## 拟定变更

### 1. 实体类变更
#### [MODIFY] [KnowledgeGraph.java](file:///d:/idea%20projects/KnowledgeGraphPlatform/demo/src/main/java/com/sdu/kgplatform/entity/KnowledgeGraph.java)
- 添加 `private Double hotScore = 0.0;` 字段及 Getter/Setter。

### 2. 服务层变更
#### [MODIFY] [GraphService.java](file:///d:/idea%20projects/KnowledgeGraphPlatform/demo/src/main/java/com/sdu/kgplatform/service/GraphService.java)
- **修复 Bug**: 在 `createPageable` 中支持 `viewCount` (前端传参) 和 `hot` (热度排序)。
- **新增功能**: 实现 `updateAllHotScores()` 方法，包含热度计算公式。

### 3. 定时任务
#### [NEW] [HotScoreTask.java](file:///d:/idea%20projects/KnowledgeGraphPlatform/demo/src/main/java/com/sdu/kgplatform/task/HotScoreTask.java)
- 新建定时任务，每小时调用一次 `graphService.updateAllHotScores()`。

## 验证计划
1.  **修复验证**: 刷新首页，确认“推荐”不再完全等于“最新”。
2.  **热度验证**:
    - 手动触发一次热度计算。
    - 访问 `/api/graph/public?sortBy=hot`。
    - 确认高收藏、新发布的图谱排在前面。
